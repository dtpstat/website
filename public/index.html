<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="shortcut icon" href="https://dtp-stat.ru/static/media/logo.ico" type="image/x-icon" />

    <meta property="og:image" content="https://dtp-stat.ru/static/media/og.png" />

    <meta property="og:title" content="Карта ДТП" />
    <meta property="og:description" content="Карта ДТП" />
    <meta name="description" content="Карта ДТП" />
    <meta name="keywords" content="Карта ДТП" />
    <title>Карта ДТП</title>

    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
    />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Merriweather&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="https://dtp-stat.ru/static/css/style.css" />

    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"
    ></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

    <!-- <link href="/static/css/map/2.a1840750.chunk.css" rel="stylesheet" />
    <link href="/static/css/map/main.ddc91512.chunk.css" rel="stylesheet" /> -->
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-light">
      <a class="navbar-brand" href="/">
        <img src="https://dtp-stat.ru/static/media/logo.png" />
      </a>
      <button
        class="navbar-toggler"
        type="button"
        data-toggle="collapse"
        data-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent"
        aria-expanded="false"
        aria-label="Toggle navigation"
      >
        <span class="navbar-toggler-icon"></span>
      </button>

      <form class="form-inline mr-auto mt-2 mt-lg-0 d-lg-block" role="form">
        <div class="form-group">
          <input class="form-control" type="text" id="regionSearch" />
          <i class="fas fa-search"></i>
        </div>
      </form>

      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav ml-auto my-2 my-lg-0">
          <li class="nav-item">
            <div style="">
              <a class="nav-link" href="/blog/">Что почитать</a>
            </div>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/opendata/">Скачать данные</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/pages/about/">О проекте</a>
          </li>
          <li class="nav-item support">
            <a class="nav-link button support" href="/donate/">Поддержать проект</a>
          </li>
        </ul>
      </div>
    </nav>

    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>

    <script>
      ;(function () {
        function makeSearch(term, coords, callback) {
          url =
            'https://autosuggest.search.hereapi.com/v1/autosuggest?at=' +
            coords +
            '&lang=ru&apiKey=RiiGcCcn0R9NGRwFZN311cD12LIyDil7BvOJLliMjdg&limit=10&q=' +
            term
          $.get(url).done(function (data) {
            options = data.items.map(function (item) {
              if (item.address.label.includes('Россия')) {
                return {
                  label: item.title,
                  value: item.title,
                  coords: item.position,
                }
              }
            })
            console.log(options)
            callback(options)
          })
        }

        function replaceUrlParam(url, paramName, paramValue) {
          if (paramValue == null) {
            paramValue = ''
          }
          var pattern = new RegExp('\\b(' + paramName + '=).*?(&|#|$)')
          if (url.search(pattern) >= 0) {
            return url.replace(pattern, '$1' + paramValue + '$2')
          }
          url = url.replace(/[?#]$/, '')
          return url + (url.indexOf('?') > 0 ? '&' : '?') + paramName + '=' + paramValue
        }

        function goToRegionPage(coords) {
          var url = window.location.href
          var url = replaceUrlParam(
            url,
            'center',
            coords.lat.toString() + ':' + coords.lng.toString()
          )
          var url = replaceUrlParam(url, 'zoom', '13')
          window.location.href = url
        }

        $('#regionSearch').autocomplete({
          minLength: 3,
          source: function (request, response) {
            var url = new URL(window.location.href)
            var coords = url.searchParams.get('c')
            if (coords == null) {
              coords = '55.7498,37.6179'
            } else {
              coords = coords.replace('_', ',')
            }
            makeSearch(request.term, coords, response)
          },
          select: function (event, ui) {
            goToRegionPage(ui.item.coords)
          },
        })
      })()
    </script>

    <div id="root"></div>

    <script
      src="https://api-maps.yandex.ru/2.1/?apikey=ad7c40a7-7096-43c9-b6e2-5e1f6d06b9ec&lang=ru_RU"
      type="text/javascript"
    ></script>
    <script
      src="https://yastatic.net/s3/mapsapi-jslibs/heatmap/0.0.1/heatmap.min.js"
      type="text/javascript"
    ></script>
    <script>
      !(function (e) {
        function t(t) {
          for (var n, p, l = t[0], a = t[1], f = t[2], c = 0, s = []; c < l.length; c++)
            (p = l[c]),
              Object.prototype.hasOwnProperty.call(o, p) && o[p] && s.push(o[p][0]),
              (o[p] = 0)
          for (n in a) Object.prototype.hasOwnProperty.call(a, n) && (e[n] = a[n])
          for (i && i(t); s.length; ) s.shift()()
          return u.push.apply(u, f || []), r()
        }
        function r() {
          for (var e, t = 0; t < u.length; t++) {
            for (var r = u[t], n = !0, l = 1; l < r.length; l++) {
              var a = r[l]
              0 !== o[a] && (n = !1)
            }
            n && (u.splice(t--, 1), (e = p((p.s = r[0]))))
          }
          return e
        }
        var n = {},
          o = { 1: 0 },
          u = []
        function p(t) {
          if (n[t]) return n[t].exports
          var r = (n[t] = { i: t, l: !1, exports: {} })
          return e[t].call(r.exports, r, r.exports, p), (r.l = !0), r.exports
        }
        ;(p.m = e),
          (p.c = n),
          (p.d = function (e, t, r) {
            p.o(e, t) || Object.defineProperty(e, t, { enumerable: !0, get: r })
          }),
          (p.r = function (e) {
            'undefined' != typeof Symbol &&
              Symbol.toStringTag &&
              Object.defineProperty(e, Symbol.toStringTag, { value: 'Module' }),
              Object.defineProperty(e, '__esModule', { value: !0 })
          }),
          (p.t = function (e, t) {
            if ((1 & t && (e = p(e)), 8 & t)) return e
            if (4 & t && 'object' == typeof e && e && e.__esModule) return e
            var r = Object.create(null)
            if (
              (p.r(r),
              Object.defineProperty(r, 'default', { enumerable: !0, value: e }),
              2 & t && 'string' != typeof e)
            )
              for (var n in e)
                p.d(
                  r,
                  n,
                  function (t) {
                    return e[t]
                  }.bind(null, n)
                )
            return r
          }),
          (p.n = function (e) {
            var t =
              e && e.__esModule
                ? function () {
                    return e.default
                  }
                : function () {
                    return e
                  }
            return p.d(t, 'a', t), t
          }),
          (p.o = function (e, t) {
            return Object.prototype.hasOwnProperty.call(e, t)
          }),
          (p.p = '/')
        var l = (this['webpackJsonpdtp-map'] = this['webpackJsonpdtp-map'] || []),
          a = l.push.bind(l)
        ;(l.push = t), (l = l.slice())
        for (var f = 0; f < l.length; f++) t(l[f])
        var i = a
        r()
      })([])
    </script>
    <!-- <script src="/static/js/map/2.12aa7db6.chunk.js"></script>
    <script src="/static/js/map/main.043ec281.chunk.js"></script> -->

    <script>
      let progress_bar = $('.progress-bar')
      progress_bar.css('background-size', progress_bar.parent().width() + 'px')
    </script>

    <script>
      $(document).on('click', 'a[href^="#"]', function (e) {
        if ($(this).attr('data-toggle') !== 'collapse') {
          // target element id
          var id = $(this).attr('href')

          // target element
          var $id = $(id)
          if ($id.length === 0) {
            return
          }

          // prevent standard hash navigation (avoid blinking in IE)
          e.preventDefault()

          // top position relative to the document
          var pos = $(id).offset().top

          // animated top scrolling
          $('body, html').animate({ scrollTop: pos }, 500)
        }
      })
    </script>
  </body>
</html>
